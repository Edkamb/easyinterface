window.AddInLineMarkerCommand=function(){function c(a){this.codearea=a.codearea;this.lines=a.lines;this.outclass=a.outclass;this.content=a.content;this.dest=a.dest;this.inlinemarker=this.codearea.linewidget(this.dest,{lines:this.lines,outclass:this.outclass,content:this.content})}c.parse=function(a,b){if(a[0].tagName!=_ei.outlang.syntax.addinlinemarker)return null;var d=a.attr(_ei.outlang.syntax.dest)||b.dest,f=a.attr(_ei.outlang.syntax.outclass)||b.outclass,e=a.find("> "+_ei.outlang.syntax.content),
g=getLines(a.find("> "+_ei.outlang.syntax.lines));return new c({dest:d,lines:g,outclass:f,content:e,codearea:b.codearea})};c.prototype={constructor:c,"do":function(){this.inlinemarker["do"]()},undo:function(){this.inlinemarker.undo()}};return c}();
window.AddMarkerCommand=function(){function c(a){this.dest=a.dest;this.codearea=a.codearea;this.lines=a.lines;this.outclass=a.outclass;this.msg=a.content;this.format=a.format;this.content=a.content;this.boxtitle=a.boxtitle;this.boxwidth=a.boxwidth;this.boxheight=a.boxheight;this.markerWidget=this.codearea.marker(this.dest,{boxtitle:this.boxtitle,boxwidth:this.boxwidth,boxheight:this.boxheight,lines:this.lines,outclass:this.outclass,content:this.content,gutter:"infoGutter"})}c.parse=function(a,b){if(a[0].tagName!=
_ei.outlang.syntax.addmarker)return null;var d=a.attr(_ei.outlang.syntax.dest)||b.dest,f=a.attr(_ei.outlang.syntax.outclass)||b.outclass,e=a.find("> "+_ei.outlang.syntax.content),g=getLines(a.find("> "+_ei.outlang.syntax.lines)),h=a.attr(_ei.outlang.syntax.boxtitle),k=parseInt(a.attr(_ei.outlang.syntax.boxwidth)),l=parseInt(a.attr(_ei.outlang.syntax.boxheight));return new c({dest:d,lines:g,boxtitle:h,boxwidth:k,boxheight:l,outclass:f,content:e,codearea:b.codearea})};c.prototype={constructor:c,"do":function(){this.markerWidget["do"]()},
undo:function(){this.markerWidget.undo()}};return c}();
window.CheckBoxWidget=function(){function c(a){this.widgetInfo=a;this.id=a.id;this.isBoolean=a.isBoolean;this.env=$("<div class='ei-paramwidget-checkbox'></div>");this.options=[];this.env.append("<div class='params-left-col'></div>");for(var b=$("<div class='params-mid-col'></div>"),d=0;d<a.options.length;d++){var f=$("<div><div class='desc'>"+a.options[d].desc["short"]+"</div><div class='selector'><input class='ui-widget ui-state-default ui-corner-all' type='checkbox' value='"+a.options[d].value+
"'"+(a.options[d].selected?" checked='checked'":"")+"/></div></div>");this.options[d]=f.find("input");b.append(f);a.callback&&this.options[d].change(function(){a.callback($(this).prop("value"),$(this).prop("checked"))})}this.env.append(b);this.env.append("<div class='params-right-col'></div>")}c.prototype={constructor:c,domRoot:function(){return this.env},getId:function(){return id},getValue:function(){for(var a=[],b=0,d=0;d<this.options.length;d++)this.options[d].prop("checked")&&(a[b]=this.options[d].prop("value"),
b++);this.isBoolean&&0==a.length&&(a[0]="no");return a},restoreDefault:function(){var a=this;this.env.find("input").each(function(b,d){a.widgetInfo.options[b].selected?$(d).attr("checked","checked"):$(d).removeAttr("checked")})}};return c}();
window.CmdEngine=function(){function c(a){}c.prototype={constructor:c,setOptions:function(a){},exec:function(a,b,d){var f={command:_ei.serverCommand.app.execute,app_id:a.appId,parameters:{}},e;for(e in a.params){var g=[],g=[].concat(a.params[e]);f.parameters[e]=g}a.files&&(f.parameters._ei_files=a.files);if(a.entries){for(var c in a.entries);f.parameters._ei_outline=a.entries}f.parameters._ei_clientid=_ei.clientId;f=JSON.stringify(f);$.post(a.server,{eirequest:f}).done(function(a){try{a=jQuery.parseXML(a),
_ei.debug&&console.log(a),b(a)}catch(f){d(f)}}).error(function(b){_ei.debug&&console.log("Error: ",b);d(b)})}};return c}();
window.CodeArea=function(){function c(b,d){a++;this.filemanager=null;this.tabsId="CATab-"+a;this.tabCounter=0;this.tabs=null;this.tabsHolder=b;this.tabsOptions=d;this.tabInfoByPos=[];this.tabInfoById=[];this.currTabId=null;this.setOptions();this.initTabs();var f=this;this.tabs.delegate("span.ui-icon-close","click",function(){var b=$(this).closest("li").attr("aria-controls");f.hideTab(f.tabTag_to_tabId(b))});this.tabs.delegate("span.ui-icon-extlink","click",function(){var b=$(this).closest("li").attr("aria-controls");
f.expandTab(f.tabTag_to_tabId(b))})}var a=0;c.prototype={constructor:c,tabId_to_tabTag:function(b){return"tabs-"+b},tabTag_to_tabId:function(b){return b.substr(5,b.length-5)},addFileManager:function(b){this.filemanager=b},setOptions:function(){},initTabs:function(){var b=this;this.tabs=$(this.tabsHolder).append("<div id='"+this.tabsId+"' class='ei-codearea'><ul></ul></div>").find("#"+this.tabsId);this.tabs.tabs({activate:function(d,a){var e=a.newTab.attr("aria-controls");b.switchTab(b.tabTag_to_tabId(e))}})},
switchTab:function(b){var d=this.tabInfoById[b];this.tabs.tabs("option","active",d.pos);d.editor.refresh();setTimeout(function(){d.editor.focus()},0);this.currTabId=b},createTab:function(b,d,a){var e=this.tabId_to_tabTag(d),g=$("<li id='tablabel-"+e+"'><a href='#"+e+"'>"+b+"</a><span style='display:inline-block;' class='ui-icon ui-icon-extlink'></span><span style='display:inline-block;' class='ui-icon ui-icon-close'></span></li>");this.tabs.find(".ui-tabs-nav").append(g);var c=$("<div style='padding: 1px' class='ei-codearea-content' id='"+
e+"'><div id='"+e+"-ed'></div></div>");this.tabs.append(c);a=CodeMirror(c.find("#"+e+"-ed").get(0),{lineNumbers:!0,mode:"javascript",value:a,gutters:["actionGutter","CodeMirror-linenumbers","infoGutter"],highlightSelectionMatches:{showToken:/\w/}});b={id:d,pos:this.tabCounter,label:b,editor:a,edArea:this.tabs.find("#"+e+"-ed")[0],visible:!0,panel:g,content:c};this.tabInfoByPos[b.pos]=b;this.tabInfoById[d]=b;this.tabCounter++;this.tabs.tabs("refresh");this.switchTab(d)},hideTab:function(b){this.tabId_to_tabTag(b);
b=this.tabInfoById[b];this.tabs.tabs("option","active")==b.pos&&(this.tabInfoByPos[b.pos+1]?this.switchTab(this.tabInfoByPos[b.pos+1].id):this.tabInfoByPos[b.pos-1]&&this.switchTab(this.tabInfoByPos[b.pos-1].id));b.visible=!1;b.panel.detach();b.content.detach();this.tabs.tabs("refresh");this.tabInfoByPos.splice(b.pos,1);for(b=b.pos;b<this.tabInfoByPos.length;b++)this.tabInfoByPos[b].pos--;this.tabCounter--;0==this.tabCounter&&(this.currTabId=null)},updateContent:function(b,d){var a=this.tabInfoById[b];
a.content=d;a.editor.setValue(d);this.tabInfoByPos[a.pos]=a},showTab:function(b){this.tabId_to_tabTag(b);var a=this.tabInfoById[b];a.visible||(this.tabs.find(".ui-tabs-nav").append(a.panel),this.tabs.append(a.content),a.panel.show(),a.content.show(),a.visible=!0,a.pos=this.tabCounter,this.tabInfoByPos[a.pos]=a,this.tabCounter++,this.tabs.tabs("refresh"));this.switchTab(b)},expandTab:function(b){var a=this;this.hideTab(b);this.tabId_to_tabTag(b);var f=this.tabInfoById[b];$("<div></div>").append($(f.content)).dialog({title:f.label,
beforeClose:function(e,g){f.content.removeClass("ei-codearea-content-expanded");a.showTab(b)}});f.content.addClass("ei-codearea-content-expanded");f.content.show()},getTabContent:function(b){this.tabId_to_tabTag(b);return this.tabInfoById[b].editor.getValue()},highlightLines:function(b,a){Number(b)||(b=this.filemanager.getIdByPath(b));if(0>b)throw"highlightLines: invalid file name";return new HighlightLinesWidget({lines:a.lines,color:a.color,outclass:a.outclass,editor:this.tabInfoById[b].editor})},
marker:function(b,a){Number(b)||(b=this.filemanager.getIdByPath(b));if(0>b)throw"marker: invalid file name";this.filemanager.openFile(b);return new MarkerWidget({lines:a.lines,content:a.content,outclass:a.outclass,onclick:a.onclick,gutter:a.gutter,editor:this.tabInfoById[b].editor})},linewidget:function(b,a){Number(b)||(b=this.filemanager.getIdByPath(b));if(0>b)throw"linewidget: invalid file name";return new InlinedMarkerWidget({lines:a.lines,content:a.content,outclass:a.outclass,editor:this.tabInfoById[b].editor})},
getCurrentTabId:function(){return this.currTabId}};return c}();
window.CodeLineAction=function(){function c(a){var b=this;this.codearea=a.codearea;this.lines=a.lines;this.content=0==a.content.length?null:a.content;this.dest=a.dest;this.outputmanager=a.outputmanager;this.autoclean=a.autoclean;this.boxheight=a.boxheight;this.boxwidth=a.boxwidth;this.commands=new Set;a.eicommands.each(function(){var d=$(this).attr(_ei.outlang.syntax.dest)||a.dest;$(this).attr(_ei.outlang.syntax.outclass);$(this).children().each(function(){a.outputmanager.parseCommand($(this),b.commands,
{dest:d,outclass:a.outclass,outputmanager:a.outputmanager,filemanager:a.filemanager,codearea:a.codearea,console:a.console,defaultConsoleId:a.defaultConsoleId})})});this.markerWidget=this.codearea.marker(this.dest,{boxtitle:this.boxtitle,boxwidth:this.boxwidth,boxheight:this.boxheight,lines:this.lines,outclass:"arrow",content:this.content,gutter:"actionGutter",onclick:function(){b.outputmanager.performAction(b)}})}c.parse=function(a,b){if(a[0].tagName!=_ei.outlang.syntax.oncodelineclick)return null;
var d=a.attr(_ei.outlang.syntax.dest)||b.dest,f=a.attr(_ei.outlang.syntax.outclass)||b.outclass,e=a.find("> "+_ei.outlang.syntax.content),g=getLines(a.find("> "+_ei.outlang.syntax.lines)),h=a.attr(_ei.outlang.syntax.actionautoclean)||b.autoclean,h="true"==h?!0:!1,k=a.attr(_ei.outlang.syntax.boxtitle),l=parseInt(a.attr(_ei.outlang.syntax.boxwidth)),m=parseInt(a.attr(_ei.outlang.syntax.boxheight)),n=a.find("> "+_ei.outlang.syntax.eicommands);return new c({dest:d,lines:g,content:e,outclass:f,autoclean:h,
boxtitle:k,boxwidth:l,boxheight:m,eicommands:n,codearea:b.codearea,outputmanager:b.outputmanager,filemanager:b.filemanager,console:b.console,defaultConsoleId:b.defaultConsoleId})};c.prototype={constructor:c,activate:function(){this.markerWidget["do"]()},deActivate:function(){this.undoAction();this.markerWidget.undo()},doAction:function(){this.markerWidget.selectMarker();this.commands&&this.commands.asyncIterate(function(a){a["do"]()})},undoAction:function(){this.markerWidget.unselectMarker();this.commands&&
this.commands.asyncIterate(function(a){a.undo()})}};return c}();
window.ComboWidget=function(){function c(a){var b=this;this.widgetInfo=a;this.id=a.id;this.env=$("<div class='ei-paramwidget-combo'></div>");this.env.append("<div class='params-left-col'></div><div class='params-mid-col'><div class='desc'>"+a.desc["short"]+"</div><div class='selector'><select class='ui-widget ui-state-default ui-corner-all'></select></div></div>");this.select=this.env.find("select");a.multiple&&this.select.attr("multiple","multiple");a.callback&&this.select.change(function(){a.callback({value:b.select.val()})});
for(var d=0;d<a.options.length;d++){var f=$(document.createElement("option"));f.append(a.options[d].desc["short"]);f.attr("value",a.options[d].value);a.options[d].value==a.default_value&&f.attr("selected","selected");this.select.append(f)}a.desc["long"]&&(d=$("<div class='params-right-col'><span class='ui-icon ui-icon-info'></span></div>"),this.env.append(d),d.tooltip({items:d.find("span"),content:a.desc["long"]}))}c.prototype={constructor:c,domRoot:function(){return this.env},getId:function(){return id},
getValue:function(){var a=[];return a=this.select.val()},restoreDefault:function(){var a=this;this.env.find("option").each(function(b,d){$(d).attr("value")==a.widgetInfo.default_value?$(d).attr("selected","selected"):$(d).removeAttr("selected")})}};return c}();
window.Console=function(){function c(b,d){a++;this.place=b;this.initConsole()}var a=0;c.prototype={constructor:c,winId_to_winTag:function(b){return"conwin-"+b},winTag_to_winId:function(b){return b.substr(7,b.length-7)},initConsole:function(){var b=this;this.consId="CONS-"+a;this.consHolder=this.place;this.currTabId=this.tabCounter=0;this.winInfoById=[];this.winInfoByPos=[];this.winId=0;this.tabs&&$(this.consHolder).find("#"+this.consId).remove();this.tabs=$(this.consHolder).append("<div id='"+this.consId+
"' class='ei-console'><ul class='ei-console-panel'></ul></div>").find("#"+this.consId);this.tabs.prepend("<div  class='ei-console-options' style='float: right;'></div>");this.tabs.find(".ei-console-options").append("<button class='ei-console-close-button'></button>");this.tabs.find(".ei-console-close-button").button({icons:{primary:"ui-icon-closethick"},text:!1}).click(function(){for(;0<b.winInfoByPos.length;)b.hideWin(b.winInfoByPos[0].id);b.tabs.find("#ei-console-list").val("none")});this.tabs.find(".ei-console-options").append("<button class='ei-console-add-button'></button>");
this.tabs.find(".ei-console-add-button").button({icons:{primary:"ui-icon-plusthick"},text:!1}).click(function(){for(;"undefined"!=typeof b.winInfoById[b.winId];)b.winId++;var a=b.createWin(b.winId,"Some title "+b.winId);b.switchWin(a)});this.tabs.find(".ei-console-options").append("<select class='custom-combobox custom-combobox-input ui-widget ui-widget-content ui-state-default ui-corner-all' id='ei-console-list'></select>");this.tabs.find("#ei-console-list").append("<option value='none'>List of Consoles</option>");
this.tabs.find("#ei-console-list").change(function(){var a=$(this).val();"none"!=a?b.showWin(a):(a=b.currWinId(),0<=a&&$(this).val(a))});this.tabs.tabs({activate:function(a,f){var e=f.newTab.attr("aria-controls");b.switchWin(b.winTag_to_winId(e))}});this.marker=$("");this.tabs.delegate("span.ui-icon-close","click",function(){var a=b.winTag_to_winId($(this).closest("li").attr("aria-controls"));b.hideWin(a)});this.tabs.delegate("span.ui-icon-extlink","click",function(){var a=b.winTag_to_winId($(this).closest("li").attr("aria-controls"));
b.expandWin(a)})},existWin:function(b){return b&&this.winInfoById[b]},createWin:function(b,a){var f=this;if(this.existWin(b))return null;if(!b){for(;"undefined"!=typeof this.winInfoById[this.winId];)this.winId++;b=this.winId;this.winId++}var e=this.winId_to_winTag(b);a||(a="Console "+b);f=$("<li id='tablabel-"+e+"'><a href='#"+e+"'>"+a+"</a><span style='display:inline-block;' class='ui-icon ui-icon-extlink'></span><span style='display:inline-block;' class='ui-icon ui-icon-close'></span></li>");this.tabs.find(".ui-tabs-nav").append(f);
e=$("<div id='"+e+"' class='ei-console-content'> </div>");this.tabs.append(e);f={id:b,pos:this.tabCounter,label:a,visible:!0,panel:f,content:e};this.winInfoByPos[f.pos]=f;this.winInfoById[b]=f;this.tabCounter++;this.tabs.tabs("refresh");f=this;e=$("<option value='"+b+"'>"+a+"</option>");f.tabs.find("#ei-console-list").append(e);return b},hideWin:function(b){this.winId_to_winTag(b);b=this.winInfoById[b];this.tabs.tabs("option","active")==b.pos&&(this.winInfoByPos[b.pos+1]?this.switchWin(this.winInfoByPos[b.pos+
1].id):this.winInfoByPos[b.pos-1]&&this.switchWin(this.winInfoByPos[b.pos-1].id));b.visible=!1;b.panel.detach();b.content.detach();this.tabs.tabs("refresh");this.winInfoByPos.splice(b.pos,1);for(b=b.pos;b<this.winInfoByPos.length;b++)this.winInfoByPos[b].pos--;this.tabCounter--;0==this.tabCounter&&(this.currTabId=null)},showWin:function(b){this.winId_to_winTag(b);var a=this.winInfoById[b];a.visible||(this.tabs.find(".ui-tabs-nav").append(a.panel),this.tabs.append(a.content),a.panel.show(),a.content.show(),
a.visible=!0,a.pos=this.tabCounter,this.winInfoByPos[a.pos]=a,this.tabCounter++,this.tabs.tabs("refresh"));this.switchWin(b)},expandWin:function(b){var a=this;this.hideWin(b);this.winId_to_winTag(b);var f=this.winInfoById[b];f.content.addClass("ei-console-content-expanded");$("<div style='height: 70%; overflow: auto;'></div>").append(f.content).dialog({width:500,height:300,title:f.label,beforeClose:function(e,g){f.content.removeClass("ei-console-content-expanded");a.showWin(b)}});f.content.show()},
delWin:function(){},switchWin:function(b){this.tabs.tabs("option","active",this.winInfoById[b].pos);this.tabs.find("#ei-console-list").val(b);this.currTabId=b},clearWin:function(b){null==b&&(b=this.currWinId());this.winId_to_winTag(b);this.winInfoById[b]&&this.winInfoById[b].content.empty()},addContentToWin:function(b,a){null==b&&(b=this.currWinId());if(this.existWin(b)){this.winId_to_winTag(b);var f=$("<div></div>");f.append($(a));this.showWin(b);this.winInfoById[b].content.append(f);return f}},
currWinId:function(){return this.currTabId}};return c}();
var _ei={clientId:"web_client",serverPath:"",exampleServerPath:"",serverCommand:{all:"_ei_all",app:{details:"app_details",execute:"execute"},example:{details:"exset_details"}},outlang:{syntax:{eicommands:"eicommands",eiactions:"eiactions",eiout:"eiout",dest:"dest",color:"color",elements:"elements",selector:"selector",selectorvalue:"value",outclass:"outclass",info:"info",warning:"warning",error:"error",lines:"lines",line:"line",content:"content",format:"format",htmlcontent:"html",svgcontent:"svg",
textcontent:"text",printonconsole:"printonconsole",consoleid:"consoleid",consoletitle:"consoletitle",addmarker:"addmarker",addinlinemarker:"addinlinemarker",highlightlines:"highlightlines",writefile:"writefile",filename:"filename",overwrite:"overwrite",setcss:"setcss",cssproperties:"cssproperties",cssproperty:"cssproperty",csspropertyname:"name",csspropertyvalue:"value",dialogbox:"dialogbox",boxtitle:"boxtitle",boxwidth:"boxwidth",boxheight:"boxheigh",oncodelineclick:"oncodelineclick",actionautoclean:"autoclean",
onclick:"onclick"}},debug:!0,file_ext:".abs",pprefix:"-",outline:{server:"",app:"absoutline"},general_settings:{show_svg_in_new_window:"no",file_selection_mode:"file"}};
window.DialogBoxCommand=function(){function c(a){this.boxtitle=a.boxtitle;this.boxwidth=a.boxwidth;this.boxheight=a.boxheight;this.msg=$("<div title='"+this.boxtitle+"'></div>");this.content=(new DocContent({content:a.content,outclass:a.outclass})).getDOM();this.msg.append(this.content);this.dialogBox=null}c.parse=function(a,b){if(a[0].tagName!=_ei.outlang.syntax.dialogbox)return null;var d=a.attr(_ei.outlang.syntax.outclass)||b.outclass,f=a.attr(_ei.outlang.syntax.boxtitle)||"Dialog Box",e=parseInt(a.attr(_ei.outlang.syntax.boxwidth))||
200,g=parseInt(a.attr(_ei.outlang.syntax.boxheight))||200,h=a.find("> "+_ei.outlang.syntax.content);return new c({outclass:d,boxtitle:f,boxwidth:e,boxheight:g,content:h})};c.prototype={constructor:c,"do":function(){this.dialogBox?this.dialogBox.dialog("open"):this.dialogBox=$(this.msg).dialog({width:this.boxwidth,height:this.boxheight})},undo:function(){this.dialogBox&&this.dialogBox.dialog("close")}};return c}();
window.DocContent=function(){function c(a){var b=this;this.ContentCollection=[HTMLContent,SVGContent,TextContent];this.content=$("<div></div>");a.content.each(function(){var d=b.parseContent($(this),{outclass:a.outclass});b.content.append(d.getDOM())})}c.prototype={constructor:c,parseContent:function(a,b){for(var d=null,f=0;f<this.ContentCollection.length;f++)if(d=this.ContentCollection[f].parse(a,b),null!=d)return d;console.log("Error while parsing content environment:");console.log(a);throw"Parsing a content environment has failed";
},getDOM:function(){return this.content}};return c}();
window.EasyInterface=function(){function c(b){var a=this;this.cfgFile=this.theme=this.holder=null;this.userDefaultProjectId=this.userProjectsCatId=-1;this.cmdengine=this.outline=this.console=this.parameters=this.codearea=this.filemanager=this.tools=this.settingsFileContent=null;this.generalSettingId=0;this.initialize(b);this.loadTheme(b);this.codeareaHolder=this.holder.find("#codearea");this.filemanagerHolder=this.holder.find("#filemanager");this.consoleHolder=this.holder.find("#console");this.parametersHolder=
this.holder.find("#parameters");this.helpsHolder=this.holder.find("#helps");this.helpButtonHolder=this.holder.find("#help");this.optionsButtonHolder=this.holder.find("#options");this.applyButtonHolder=this.holder.find("#apply");this.toolSelectHolder=this.holder.find("#toolselector");this.outlineHolder=this.holder.find("#outline");this.outlineButtonHolder=this.holder.find("#refreshoutline");this.initCmdEngine();this.initCodeAreaWidget();this.initFileManagerWidget();this.initParametersWidget();this.initHelpWidget();
this.initGeneralSetting();this.initConsoleWidget();this.initToolSelectorWidget();this.initOutlineWidget();this.initOutputManager();this.initTools();this.filemanager.setProperties(this.outline,this.tools);this.applyButtonHolder.button({icons:{primary:"ui-icon-play"}}).click(function(){var b=[a.codearea.getCurrentTabId()];a.tools.apply(b)});this.optionsButtonHolder.button({icons:{primary:"ui-icon-gear"}}).click(function(){a.parametersHolder.dialog("open")});this.helpButtonHolder.button({icons:{primary:"ui-icon-help"}}).click(function(){a.helpsHolder.dialog("open")});
$("#clearanno").button({icons:{primary:"ui-icon-tag"}}).click(function(){a.outputmanager.clearAllAnnotations()});this.outlineButtonHolder.button({icons:{primary:"ui-icon-arrowrefresh-1-w"}}).click(function(){var b=[a.codearea.getCurrentTabId()];a.outline.refresh(b)})}var a=[{server:"/ei/server/eiserver.php",apps:"_all"}],b=[{server:"/ei/server/eiserver.php",examples:"_all"}];c.prototype={constructor:c,initialize:function(d){if(!d.holder)throw"You must specify a holder for EasyInterface!";this.holder=
$(d.holder);this.theme=d.theme||"default";this.cfgFile=d.cfgFile||"./settings.cfg";_ei.serverPath=d.apps||a;_ei.exampleServerPath=d.examples||b;_ei.outline.app=d.outlineapp||"outline";_ei.outline.server=d.outlineserver||_ei.serverPath[0].server},loadTheme:function(){var b=this;$.ajax({async:!1,cache:!1,url:this.theme,success:function(a){b.holder.append(a)}})},initCodeAreaWidget:function(){this.codearea=new CodeArea(this.codeareaHolder,{})},initFileManagerWidget:function(){var b=this;this.filemanager=
new FileManager(this.filemanagerHolder,{codearea:this.codearea,callback:function(){b.initFileManager()}});this.codearea.addFileManager(this.filemanager)},initParametersWidget:function(){var b=this;this.parameters=new Parameters(this.parametersHolder,{});this.parametersHolder.dialog({title:"Settings",autoOpen:!1,height:400,width:700,modal:!0,show:{effect:"fadeIn",duration:500},hide:{effect:"fadeOut",duration:500},buttons:{Close:function(){$(this).dialog("close")},"Restore Default":function(){b.parameters.restoreDefaultValues(-1,
b.tools.getNumTools()+1)}}})},initHelpWidget:function(){this.helps=new Helps(this.helpsHolder,{});this.helpsHolder.dialog({title:"Tools Help",autoOpen:!1,height:400,width:700,modal:!0,show:{effect:"fadeIn",duration:500},hide:{effect:"fadeOut",duration:500},buttons:{Close:function(){$(this).dialog("close")}}})},initGeneralSetting:function(){this.generalSettingId=0;this.parameters.addSection("General Settings",this.generalSettingId);var b={id:"output_mode",desc:{"short":"Output mode","long":"This option allows selecting where to display the output when a tools is applied. It can be in the default tab, the current tab, or a new tab"},
options:[{desc:{"short":"Default Tab","long":""},value:"default"},{desc:{"short":"Current Tab","long":""},value:"current"},{desc:{"short":"New Tab","long":""},value:"new"}],default_value:_ei.general_settings.output_mode,callback:function(b){_ei.general_settings.output_mode=b.value}};this.parameters.addCheckWidget(this.generalSettingId,{id:"show_svg_in_new_window",default_value:_ei.general_settings.show_svg_in_new_window,desc:{"short":"Output SVG content in new tab","long":"When selected, any SVG content will be display in a new tab in the console area"},
callback:function(b){_ei.general_settings.show_svg_in_new_window=b.value}});this.parameters.addComboWidget(this.generalSettingId,b)},initConsoleWidget:function(){this.console=new Console(this.consoleHolder,{})},initToolSelectorWidget:function(){this.toolSelector=new ToolSelector({holder:this.toolSelectHolder})},initOutlineWidget:function(){this.outline=new Outline({holder:this.outlineHolder,filemanager:this.filemanager,cmdengine:this.cmdengine})},initOutputManager:function(){this.outputmanager=new OutputManager({console:this.console,
codearea:this.codearea,filemanager:this.filemanager})},initCmdEngine:function(){this.cmdengine=new CmdEngine},initFileManager:function(){this.userProjectsCatId=this.filemanager.addFolder("User_Projects");var b=this.filemanager.addFile("noname1"+_ei.file_ext,this.userProjectsCatId,"",null);this.filemanager.openFile(b);this.initExamples();this.filemanager.closeAll()},initTools:function(){var b=this;this.tools=new Tools({parameters:this.parameters,selector:this.toolSelector,filemanager:this.filemanager,
outline:this.outline,cmdengine:this.cmdengine,outputmanager:this.outputmanager,helps:this.helps});var a,e;for(a in _ei.serverPath){e=_ei.serverPath[a];for(var g=!0,c=0;g&&c<e.apps.length;c+=1){var k;"_all"==e.apps?(g=!1,k={command:_ei.serverCommand.app.details,app_id:_ei.serverCommand.all}):k={command:_ei.serverCommand.app.details,app_id:e.apps[c]};$.ajax({type:"POST",async:!1,url:e.server,cache:!1,data:{eirequest:JSON.stringify(k)}}).done(function(a){a=$(jQuery.parseXML(a));a.find("ei_error").length?
alert(a.find("ei_error").text()):a.find("ei_response").find("apps").find("app").each(function(){b.initTool($(this),e.server)})})}}},initTool:function(b,a){this.tools.addTool(b,a)},initExamples:function(){var b=this,a,e;for(a in _ei.serverPath){e=_ei.exampleServerPath[a];for(var g=!0,c=0;g&&c<e.examples.length;c+=1){var k;"_all"==e.examples?(g=!1,k={command:_ei.serverCommand.example.details,exset_id:_ei.serverCommand.all}):k={command:_ei.serverCommand.example.details,exset_id:e.examples[c]};$.ajax({type:"POST",
async:!1,url:e.server,cache:!1,data:{eirequest:JSON.stringify(k)}}).done(function(e){e=$(jQuery.parseXML(e));e.find("ei_error").length?alert(e.find("ei_error").text()):b.initExamples_aux(e.find("> ei_response > examples"),a,null)})}}},initExamples_aux:function(b,a,e){var g=this;b.children().each(function(){switch($(this).prop("tagName")){case "exset":g.initExamples_aux($(this),a,e);break;case "folder":var b=$(this).attr("name"),b=g.filemanager.addFolder(b,e,"Lock");g.initExamples_aux($(this),a,b);
break;case "file":var d=$(this).text(),b=$(this).attr("name"),c=$(this).attr("url");g.filemanager.addFile(b,e,d,c,"Lock");break;case "github":b=$(this).attr("owner"),d=$(this).attr("repo"),c=$(this).attr("branch"),g.filemanager.addGithub(b,d,c,e)}})}};return c}();
window.FileManager=function(){function c(b,d){a++;this.treeId="FM-"+a;this.treeHolder=b;this.treeOptions=d;this.jstree=null;this.codearea=d.codearea;this.tools=this.outline=null;this.fmId=1;this.fmObj=[];this.fmIdByPath=[];this.objToMove=null;this.copy=!0;this.paste=!1;this.githubs=[];this.githubId=1;this.conectgithubBase=!1;this.initFileManager();this.initialize()}var a=0;c.prototype={constructor:c,fmId_to_fmTag:function(b){return"fmobj-"+b},fmTag_to_fmId:function(b){return b.replace("fmobj-","")},
setProperties:function(b,a){this.outline=b;this.tools=a},initialize:function(){},initFileManager:function(){var b=this;$(this.treeHolder).append("<div id='"+this.treeId+"'></div>");this.jstree=$(this.treeHolder).find("#"+this.treeId).jstree({json_data:{data:{}},plugins:"types core unique dnd themes json_data ui crrm contextmenu sort".split(" "),themes:{theme:"classic"},dnd:{drag_copy:"on"},types:{max_depth:-2,max_children:-2,valid_children:"file folder fileLock folderLock fileRepo folderRepo".split(" "),
types:{file:{icon:{image:"./ext/jstree/themes/classic/file.png"},valid_children:"none"},folder:{icon:{image:"./ext/jstree/themes/classic/folder.png"},valid_children:"file folder fileLock folderLock fileRepo folderRepo".split(" ")},fileLock:{delete_node:!1,remove:!1,icon:{image:"./ext/jstree/themes/classic/fileL.png"},valid_children:"none"},folderLock:{delete_node:!1,remove:!1,icon:{image:"./ext/jstree/themes/classic/folderL.png"},valid_children:["fileLock","folderLock","folderRepo"]},fileRepo:{icon:{image:"./ext/jstree/themes/classic/fileR.png"},
valid_children:"none"},folderRepo:{icon:{image:"./ext/jstree/themes/classic/folderR.png"},valid_children:["fileRepo","folderRepo"]},"#":{start_drag:!1,delete_node:!1,remove:!1,valid_children:["folder","folderLock","folderRepo"]}}},crrm:{move:{always_copy:!0,open_onmove:!1,default_position:"last",check_move:function(b){return"folder"!==$(b.np).attr("rel")||$(b.np).attr("id")===$(b.op).attr("id")?!1:!0}}},sort:function(b,a){var e=$(b).attr("rel"),g=$(a).attr("rel").replace("Lock","").replace("Repo",
"");return e==g?this.get_text(b)>this.get_text(a)?1:-1:b>a?1:-1},contextmenu:{items:function(a){switch(a.attr("rel")){case "folder":return{CreateFile:{label:"New file",action:function(a){a=a.attr("fmId");a=b.addFile(null,b.fmObj[a].node.attr("fmId"),"","");b.openFile(a)}},CreateFolder:{label:"New folder",separator_after:!0,action:function(a){a=a.attr("fmId");b.addFolder(null,b.fmObj[a].node.attr("fmId"),"")}},RemoteFile:{label:"Add Remote File...",action:function(a){a=a.attr("fmId");b.requestRemote(b,
a)}},Rename:{label:"Rename Folder",separator_before:!0,action:function(b){this.rename(b)}},Delete:{label:"Delete Folder",action:function(b){this.remove(b)}},Copy:{label:"Copy Folder",action:function(a){this.copy(a);b.copy=!0}},Cut:{label:"Cut Folder",action:function(a){this.cut(a);b.copy=!1}},Paste:{label:"Paste",separator_after:!0,action:function(a){b.paste=!0;this.paste(a)}},Apply:{label:"Apply here",separator_before:!0,action:function(a){var d=[];1==a.length?d[0]=$(a).attr("fmid"):d=$(a).attr("fmid");
b.tools.apply(d)}},Outline:{label:"Refresh Outline here",action:function(a){var d=[];1==a.length?d[0]=$(a).attr("fmid"):d=$(a).attr("fmid");b.outline.refresh(d)}}};case "folderLock":return{Copy:{label:"Copy Folder",separator_after:!0,action:function(a){this.copy(a);b.copy=!0}},Apply:{label:"Apply here",separator_before:!0,action:function(a){var d=[];1==a.length?d[0]=$(a).attr("fmid"):d=$(a).attr("fmid");b.tools.apply(d)}},Outline:{label:"Refresh Outline here",action:function(a){var d=[];1==a.length?
d[0]=$(a).attr("fmid"):d=$(a).attr("fmid");b.outline.refresh(d)}}};case "file":return{Rename:{label:"Rename File",separator_before:!0,action:function(b){this.rename(b)}},Delete:{label:"Delete File",action:function(b){this.remove(b)}},Copy:{label:"Copy File",action:function(a){this.copy(a);b.copy=!0}},Cut:{label:"Cut File",separator_after:!0,action:function(a){this.cut(a);b.copy=!1}},Apply:{label:"Apply here",separator_before:!0,action:function(a){var d=[];1==a.length?d[0]=$(a).attr("fmid"):d=$(a).attr("fmid");
b.tools.apply(d)}},Outline:{label:"Refresh Outline here",action:function(a){var d=[];1==a.length?d[0]=$(a).attr("fmid"):d=$(a).attr("fmid");b.outline.refresh(d)}}};case "folderRepo":return{Copy:{label:"Copy Folder",action:function(a){this.copy(a);b.copy=!0}},Delete:{label:"Delete Folder",action:function(b){this.remove(b)}},Apply:{label:"Apply here",separator_before:!0,action:function(a){var d=[];1==a.length?d[0]=$(a).attr("fmid"):d=$(a).attr("fmid");b.tools.apply(d)}},Outline:{label:"Refresh Outline here",
action:function(a){var d=[];1==a.length?d[0]=$(a).attr("fmid"):d=$(a).attr("fmid");b.outline.refresh(d)}}};case "fileRepo":return{Rename:{label:"Rename File",separator_before:!0,action:function(b){this.rename(b)}},Copy:{label:"Copy File",action:function(a){this.copy(a);b.copy=!0}},Delete:{label:"Delete File",action:function(b){this.remove(b)}},Apply:{label:"Apply here",separator_before:!0,action:function(a){var d=[];1==a.length?d[0]=$(a).attr("fmid"):d=$(a).attr("fmid");b.tools.apply(d)}},Outline:{label:"Refresh Outline here",
action:function(a){var d=[];1==a.length?d[0]=$(a).attr("fmid"):d=$(a).attr("fmid");b.outline.refresh(d)}}};case "fileLock":return{Copy:{label:"Copy File",separator_after:!0,action:function(a){this.copy(a);b.copy=!0}},Apply:{label:"Apply here",separator_before:!0,action:function(a){var d=[];1==a.length?d[0]=$(a).attr("fmid"):d=$(a).attr("fmid");b.tools.apply(d)}},Outline:{label:"Refresh Outline here",action:function(a){var d=[];1==a.length?d[0]=$(a).attr("fmid"):d=$(a).attr("fmid");b.outline.refresh(d)}}};
default:return null}}}}).bind("delete_node.jstree",function(a,f){var e=$(f.rslt.obj).attr("fmId"),g=$(f.rslt.parent).attr("fmId");if(g&&0<=g){var c=b.fmObj[g].info.attr.rel;if("fileLock"==c||"folderLock"==c)$.jstree.rollback(f.rlbk);else{for(var g=b.fmObj[g].info.attr.members,c=g.length,k=-1,l=0;l<c&&0>k;l++)k=g[l]==e?l:-1;0<=k&&(g[k]=g[c-1],delete g[c-1],g.length--);b.updateDelete(e,f.inst)}}else $.jstree.rollback(f.rlbk)}).bind("dblclick.jstree",function(a,f){var e=b.jstree.jstree("get_selected").attr("fmId"),
c=b.fmObj[e].info;"file"==c.attr.rel||"fileLock"==c.attr.rel||"fileRepo"==c.attr.rel?b.openFile(e):b.openFolder(e)}).bind("loaded.jstree",function(a,f){b.treeOptions.callback()}).bind("move_node.jstree",function(a,f){f.inst.get_container();var e=f.rslt,c=!1,h=b.copy;b.paste||(b.copy=!0);c=$(e.np).attr("id")==$(e.op).attr("id")?!0:$(e.np).attr("rel")&&"folder"!==$(e.np).attr("rel")?!0:b.copy?b.updateCopy(e.oc,e.np,f.inst):b.updateCut(e.o,e.np,f.inst,!0);b.copy=!0;b.paste||(b.copy=h);b.paste=!1;c&&
$.jstree.rollback(f.rlbk)}).bind("rename_node.jstree",function(a,f){var e=f.rslt.obj.attr("fmId"),c=b.fmObj[e].info,h=c.data,k=b.calculatePath(c),c=$.extend({},c),l=f.rslt.name;c.data=l;c.attr.label=l;if(l!=h){var m=b.calculatePath(c);b.existsFm(m)?($("<div>Sorry, but '"+l+"' already exists in this folder, please chosee an other name</div>").dialog({title:"Error: Name already exists",resizable:!1,height:140,modal:!0}),$.jstree.rollback(f.rlbk)):(b.fmObj[e].info.data=l,b.fmIdByPath[m]=b.fmIdByPath[k],
delete b.fmIdByPath[k],"folder"==c.attr.rel&&$(c.attr.members).each(function(a,d){var f=b.calculatePath(b.fmObj[d].info),e=f.replace(m,k);b.fmIdByPath[f]=b.fmIdByPath[e];delete b.fmIdByPath[e]}))}})},bindToCodeArea:function(b){this.codearea=b},updateDelete:function(b,a){var f=this.calculatePathById(b),e=this.fmObj[b].info.attr.rel;if("folderLock"==e||"fileLock"==e)return!0;if("folder"==e)for(var e=this.fmObj[b].info.attr.members,c=e.length,h=0;h<c;h++)this.updateDelete(e[h],a);delete this.fmObj[b];
this.fmObj.length--;delete this.fmIdByPath[f];return!1},updateCopy:function(b,a,f){var e=!1,e=this.fmObj[$(b).attr("fmid")].info;$(b).attr("rel",$(b).attr("rel").replace("Lock","").replace("Repo",""));$(b).attr("fmid",this.fmId);$(b).attr("id",this.fmId_to_fmTag(this.fmId));$(b).attr("parentid",parseInt(this.fmTag_to_fmId($(a).attr("id"))));"file"==$(b).attr("rel")?(a=this.getFileContent(e.attr.fmId),e={data:e.data,attr:{id:$(b).attr("id"),fmId:parseInt($(b).attr("fmid")),rel:$(b).attr("rel"),label:e.data,
content:a,url:null,open:!1,urlLoaded:!0,parentId:parseInt($(b).attr("parentid"))}}):e={data:e.data[0],attr:{id:$(b).attr("id"),fmId:parseInt($(b).attr("fmid")),rel:$(b).attr("rel"),members:[],parentId:parseInt($(b).attr("parentid"))}};if(a=e.attr.parentId)a=this.fmObj[a].info.attr.members,a[a.length]=e.attr.fmId;a=this.calculatePath(e);this.fmId++;this.fmIdByPath[a]=e.attr.fmId;this.fmObj[e.attr.fmId]={info:e,node:b};a=f._get_children(b);for(var c=0;c<a.length;c++)if(e=this.updateCopy(a[c],b,f))return e;
return!1},updateCut:function(b,a,f,e,c,h){var k=!1,l=this.fmObj[$(b).attr("fmid")].info;if(e){c=this.calculatePath(l);e=$(b).attr("parentid");$(b).attr("fmId");e=l.attr.parentId;$(b).attr("parentid",this.fmTag_to_fmId($(a).attr("id")));l.attr.parentId=parseInt($(b).attr("parentid"));if(a=l.attr.parentId)h=this.fmObj[a].info.attr.members,h[h.length]=l.attr.fmId;a=this.calculatePath(l);if(e&&0<=e){h=this.fmObj[e].info.attr.members;var m=h.length,n=-1;for(e=0;e<m&&0>n;e++)n=h[e]==l.attr.fmId?e:-1;0<=
n&&(h[n]=h[m-1],delete h[m-1],h.length--)}if(k)return k;h=f._get_children(b);for(e=0;e<h.length;e++)if(k=this.updateCut(h[e],b,f,!1,c,a))return k;f.remove(b);this.fmIdByPath[a]=l.attr.fmId;this.fmObj[l.attr.fmId]={info:l,node:b};delete this.fmIdByPath[c]}else{a=this.calculatePath(l);c=a.replace(h,c);this.fmIdByPath[a]=this.fmIdByPath[c];delete this.fmIdByPath[c];if(k)return k;h=f._get_children(b);for(e=0;e<h.length;e++)if(k=this.updateCut(h[e],b,f,!1,c,a))return k}return!1},addFolder:function(b,a,
f){var e=void 0;a?e=this.fmObj[a].node:a=null;var c="folder";"undefined"!==typeof f&&f&&(c=c+""+f);b||(b="noname"+this.fmId);f=this.fmId_to_fmTag(this.fmId);c={data:b,attr:{id:f,fmId:this.fmId,rel:c,members:[],label:b,parentId:a}};f=this.calculatePath(c);for(var h=this.existsFm(f),k=1;h;)c.data=k+"_"+b,c.attr.label=k+"_"+b,f=this.calculatePath(c),h=this.existsFm(f),k++;b=this.jstree.jstree("create",e,"last",c,!1,!0);this.fmObj[c.attr.fmId]={info:c,node:b};this.fmId++;a&&(a=this.fmObj[a].info.attr.members,
a[a.length]=c.attr.fmId);return this.fmIdByPath[f]=c.attr.fmId},addFile:function(b,a,f,e,c){var h=a?this.fmObj[a].node:void 0,k=this.fmId_to_fmTag(this.fmId),l="file";"undefined"!==typeof c&&c&&(l+=c);b||(b="noname"+this.fmId+_ei.file_ext);f={data:b,attr:{id:k,fmId:this.fmId,rel:l,label:b,content:f,url:e,open:!1,urlLoaded:!1,parentId:a,github:!1}};e=this.calculatePath(f);c=this.existsFm(e);for(k=1;c;)f.data=k+"_"+b,f.attr.label=k+"_"+b,e=this.calculatePath(f),c=this.existsFm(e),k++;b=this.jstree.jstree("create",
h,"last",f,!1,!0);this.fmObj[f.attr.fmId]={info:f,node:b};this.fmId++;a&&(a=this.fmObj[a].info.attr.members,a[a.length]=f.attr.fmId);return this.fmIdByPath[e]=f.attr.fmId},createFile:function(b,a,f){b=b.split("/");f=b[b.length-1];for(var e="/User_Projects/",c=1;c<b.length-1;c++)this.existsFm(e+b[c]+"/")?e=e+b[c]+"/":(this.addFolder(b[c],this.fmIdByPath[e],""),c--);this.addFile(f,this.fmIdByPath[e],a,"","")},openFile:function(b){0>b||(b=this.fmObj[b].info,b.attr.open?this.codearea.showTab(b.attr.fmId):
(this.loadFile(b.attr.fmId),this.codearea.createTab(b.attr.label,b.attr.fmId,b.attr.content),b.attr.open=!0))},loadFile:function(b){var a=this.fmObj[b].info;!a.attr.url||a.attr.urlLoaded||a.attr.urlGitHub?a.attr.urlGitHub&&!a.attr.urlLoaded&&this.githubs[a.attr.githubId].getBlob(a.attr.url,function(b,e){b?a.attr.content="Error: "+b:(a.attr.content=""+e,a.attr.urlLoaded=!0)}):$.ajax({async:!1,cache:!1,url:a.attr.url,type:"GET",error:function(b,e,c){a.attr.content="ERROR: Cannot load "+a.attr.url},
success:function(b){a.attr.content=b;a.attr.urlLoaded=!0}})},openFolder:function(a){var d=this,f=d.fmObj[a].info;if(f.attr.urlGitHub&&!f.attr.urlLoaded){var e=f.attr.githubId;d.githubs[e].getTree(f.attr.url,function(f,c){d.buildGithubTree(e,c,a)})}},getFolderFileIds:function(a,d){var f={id:a,child:[],type:"file",complete:d};if("folder"==this.fmObj[a].info.attr.rel||"folderLock"==this.fmObj[a].info.attr.rel||"folderRepo"==this.fmObj[a].info.attr.rel){var e=this.fmObj[a].info,c=e.attr.members.length;
f.type="folder";for(var h=[],k=0;k<c;k++)h[k]=this.getFolderFileIds(e.attr.members[k],!1);f.child=h;f.len=c}else f.len=0;return f},getEiFiles:function(a){for(var d=this,f=[],e=0;e<a.length;e++)f[e]=d.getFolderFileIds(a[e],!0);var c=function(a){for(var b=[],f=0;f<a.length;f++)b[f]="file"==a[f].type?{id:a[f].id,type:"file",name:a[f].complete?d.calculatePathById(a[f].id).substr(1):d.getFileName(a[f].id),content:d.getFileContent(a[f].id)}:{id:a[f].id,type:"directory",name:a[f].complete?d.calculatePathById(a[f].id).substr(1).replace(/.$/,
""):d.getFileName(a[f].id),_ei_files:c(a[f].child)};return b};a=[];return a=c(f)},getSelectedId:function(){var a=this.jstree.jstree("get_selected"),d=[];0<a.length&&a.each(function(){d[d.length]=parseInt($(this).attr("fmId"))});return d},getFileContent:function(a){var d=this.fmObj[a].info;this.loadFile(a);return d.attr.open?this.codearea.getTabContent(a):d.attr.content},getFileName:function(a){return this.fmObj[a].info.attr.label},closeAll:function(){this.jstree.jstree("close_all",-1)},getIdByPath:function(a){return this.existsFm(a)?
this.fmIdByPath[a]:-1},calculatePathById:function(a){return this.calculatePath(this.fmObj[a].info)},calculatePath:function(a){var d="";if("folder"==a.attr.rel||"folderLock"==a.attr.rel||"folderRepo"==a.attr.rel)d="/";d=a.data+d;return d=null!=a.attr.parentId?this.calculatePathById(a.attr.parentId)+d:"/"+d},existsFm:function(a){return void 0!==this.fmIdByPath[a]},joinGithubWithfm:function(a,d,f){this.fmObj[a].info.attr.githubId=d;this.fmObj[a].info.attr.urlGitHub=!0;""!=f&&(this.fmObj[a].info.attr.url=
f,this.fmObj[a].info.attr.loaded=!1)},requestRemote:function(a,d){var f=this,e=$('<div id="remoteFileSelector"></div>'),c=$('<div id="remoteOptions"></div>'),h=$('<ul id="listRO"></ul>');$(["Computer","GitHub"]).each(function(e,l){var m=$('<li><a href="#RO-'+l+'">'+l+"</a></li>"),n=$('<div id="RO-'+l+'"></div>');f.getFormRemoteFiles(n,l,a,d);$(h).append(m);$(c).append(n)});$(c).prepend(h);$(c).tabs();$(e).append(c);$(e).dialog({title:"Remote Files",resizable:!0,height:400,width:600,modal:!0,buttons:{Close:function(){$(this).dialog("close");
$(this).remove()}}})},buildGithubTree:function(a,d,f,e){var c=this;$(d).each(function(d,e){switch(e.type){case "blob":c.joinGithubWithfm(c.addFile(e.path,f,"",e.sha,"Repo"),a,"");break;case "tree":c.joinGithubWithfm(c.addFolder(e.path,f,"Repo"),a,e.sha);break;default:console.log("unknow github type.",e.type)}});e&&c.closeAll()},addGithub:function(a,d,f,e){this.conectgithubBase||(this.githubs[0]=new Github({token:"a6666d5d051c07d51ccc12dced6eebb809f13d5a",auth:"oauth"}),this.conectgithubBase=!0);this.buildRepo(this.githubs[0],
a,d,f,e,!0)},buildRepo:function(a,d,f,e,c,h){var k=this,l=""+d+"@"+f;k.githubs[l]||(k.githubs[l]=a.getRepo(d,f));a=k.githubs[l];e&&""!=e||(e="master");a.getTree(e,function(a,b){a||(c=k.addFolder(l,c,"Repo"),k.buildGithubTree(l,b,c,h))})},getFormRemoteFiles:function(a,d,f,e){var c=this;switch(d){case "Computer":$(a).append('<input type="file" id="RfilesSelector" name="files[]" multiple />');var h=$('<button id="addRFiles-'+d+'">Add Files</button>');$(h).button();$(a).append(h);var k=[];$("#RfilesSelector",
a).change(function(a){k=a.target.files});var l=function(a){var b=new FileReader;b.onloadend=function(b){b.target.readyState==FileReader.DONE&&c.addFile(escape(a.name),f.fmObj[e].node.attr("fmId"),b.target.result,"","")};var d=a.slice(0,a.size);b.readAsBinaryString(d)};$("#addRFiles-"+d,a).click(function(a){a=0;for(var b;b=k[a];a++)l(b);$("#RfilesSelector").replaceWith($("#RfilesSelector").clone())});break;case "GitHub":var m=$('<div id="addGitFiles"></div>');$(m).append($("<label>Owner: </label>"));
$(m).append($('<input type="text" id="userGH" />'));$(m).append($("<br/>"));$(m).append($("<label>Repository: </label>"));$(m).append($('<input type="text" id="repoGH" />'));$(m).append($("<br/>"));$(m).append($("<label>Branch: </label>"));$(m).append($('<input type="text" id="branchGH" value="master"/>'));$(m).append($("<br/>"));h=$('<button id="public-'+d+'">Public Repository</button>');$(h).button();$(m).append(h);$(a).append(m);$("#public-"+d,a).click(function(a){c.conectgithubBase||(c.githubs[0]=
new Github({token:"a6666d5d051c07d51ccc12dced6eebb809f13d5a",auth:"oauth"}),c.conectgithubBase=!0);a=$("#userGH").val();var b=$("#repoGH").val();if(""!=a&&""!=b){var d=$("#branchGH").val();c.buildRepo(c.githubs[0],a,b,d,f.fmObj[e].node.attr("fmId"))}});$("#private-"+d,a).click(function(a){if(""!=$("#passGH2").val()){var b=$("#userGH2").val();if(""!=b){var d=new Github({username:b,password:$("#passGH2").val(),auth:"basic"});d.getUser().repos(function(a,h){if(a)console.log(a);else{var k=c.addFolder(b+
"@Git",f.fmObj[e].node.attr("fmId"),"Repo");$(h).each(function(a,f){var e=d;f.owner!=b&&(c.conectgithubBase||(c.githubs[0]=new Github({token:"a6666d5d051c07d51ccc12dced6eebb809f13d5a",auth:"oauth"}),c.conectgithubBase=!0),e=c.githubs[0]);c.buildRepo(e,f.owner.login,f.name,f.default_branch,k)})}})}}});break;default:$(a).append("<div>Error, Unkown Service</div>")}}};return c}();
window.Helps=function(){function c(b,d){a++;this.helpId="OPTS-"+a;this.helpsHolder=b;this.accord=null;this.sectionInfoById=[];this.secId=0;this.setOptions(d);this.initHelps()}var a=0;c.prototype={constructor:c,sectionId_to_sectionTag:function(a){return"help-"+a},setOptions:function(){},initHelps:function(){$(this.helpsHolder).append("<div><p>Below you find the helps of the different section</p><div style='height: 200px;' id='"+this.helpId+"'></div></div>");this.accord=$(this.helpsHolder).find("#"+
this.helpId).accordion({collapsible:!0,heightStyle:"content",active:0,icons:{header:"ui-icon-circle-arrow-e",activeHeader:"ui-icon-circle-arrow-s"}})},addSection:function(a,d,f){var c=this.sectionId_to_sectionTag(d);this.accord.append("<h3 id='label-"+c+"'>"+a+"</h3><div id='"+c+"'></div>");this.accord.accordion("refresh");this.sectionInfoById[d]={id:d,tag:c,secId:this.secId,content:"No Help"};this.secId++;f&&0<f.length&&this.addHelpFromXML(d,f)},addHelpFromXML:function(a,d){var f=this.sectionInfoById[a],
c=d.attr(_ei.outlang.syntax.outclass)||"info",g=d.find("> "+_ei.outlang.syntax.content);0==g.length&&(d.append($("<content format='text'>No Help</content>")),g=d.find("> "+_ei.outlang.syntax.content));c=(new DocContent({content:g,outclass:c})).getDOM();g=$("<div></div>");g.append($(c));this.accord.find("#"+f.tag).append(g)},setActiveHelpSet:function(a){void 0!=a?this.accord.accordion({active:this.sectionInfoById[a].secId}):this.accord.accordion({active:!1});this.accord.accordion("refresh")}};return c}();
window.HighlightLinesCommand=function(){function c(a){this.codearea=a.codearea;this.lines=a.lines;this.outclass=a.outclass;this.dest=a.dest;this.color=a.color;this.higlightlinesWidget=this.codearea.highlightLines(this.dest,{lines:this.lines,outclass:this.outclass,color:this.color})}c.parse=function(a,b){if(a[0].tagName!=_ei.outlang.syntax.highlightlines)return null;var d=a.attr(_ei.outlang.syntax.outclass)||b.outclass,f=a.attr(_ei.outlang.syntax.dest)||b.dest,e=a.attr(_ei.outlang.syntax.color),g=
getLines(a.find("> "+_ei.outlang.syntax.lines));return new c({dest:f,lines:g,outclass:d,color:e,codearea:b.codearea})};c.prototype={constructor:c,"do":function(){this.higlightlinesWidget["do"]()},undo:function(){this.higlightlinesWidget.undo()}};return c}();
window.HighlightLinesWidget=function(){function c(a){this.editor=a.editor;this.outclass=a.outclass||_ei.outlang.syntax.info;this.color=a.color;this.lines=a.lines;this.textmarkers=[]}c.prototype={constructor:c,"do":function(){for(var a=0;a<this.lines.length;a++)if(!this.textmarkers[a]){var b=this.lines[a];null==b.init.ch&&(b.init.ch=0);null==b.end.line&&(b.end.line=b.init.line);null==b.end.ch&&(b.end.ch=0,b.end.line++);this.textmarkers[a]=this.editor.markText(b.init,b.end,{className:"highlightline-"+
this.outclass,inclusiveLeft:!0,inclusiveRight:!0})}},undo:function(){for(var a=0;a<this.lines.length;a++)this.textmarkers[a]&&(this.textmarkers[a].clear(),this.textmarkers[a]=null)}};return c}();
window.HTMLContent=function(){function c(a){this.content=$("<div></div>");this.content.append($(a.content).prop("outerHTML"))}c.parse=function(a,b){var d=a[0].tagName,f=a.attr(_ei.outlang.syntax.format);if(d!=_ei.outlang.syntax.content||f!=_ei.outlang.syntax.htmlcontent)return null;d=a.attr(_ei.outlang.syntax.outclass)||b.outclass;return new c({content:a,outclass:d})};c.prototype={constructor:c,getDOM:function(){return this.content}};return c}();
window.InlinedMarkerWidget=function(){function c(a){this.lineWidget=[];this.widget=[];this.editor=a.editor;this.lines=a.lines;this.outclass=a.outclass;this.content=(new DocContent({content:a.content,outclass:a.outclass})).getDOM()}c.prototype={constructor:c,"do":function(){var a,b,d="!";switch(this.type){case "error":a="lint-error";b="lint-error-icon";d="!!";break;case "warning":a="lint-warning";b="lint-warning-icon";d="!";break;default:a="lint-info",b="lint-info-icon",d="?"}var f=document.createElement("div"),
c=f.appendChild(document.createElement("span"));c.innerHTML=d;c.className=b;f.appendChild(document.createTextNode(this.content.text()));f.className=a;for(a=0;a<this.lines.length;a++)this.lineWidget[a]=this.editor.addLineWidget(this.lines[a].init.line,f,{above:!0,coverGutter:!1,noHScroll:!0})},undo:function(){for(var a=0;a<this.lines.length;a++)this.lineWidget[a].clear();this.lineWidget=[]}};return c}();
window.MarkerWidget=function(){function c(a){this.editor=a.editor;this.gutter=a.gutter;this.outclass=a.outclass;this.onclick=a.onclick;this.lines=a.lines;this.boxtitle=a.boxtitle||"Expanded Tooltip";this.boxwidth=a.boxwidth||200;this.boxheight=a.boxheight||200;this.content=a.content?(new DocContent({content:a.content,outclass:a.outclass})).getDOM():null;this.markers=[]}c.prototype={constructor:c,setOptions:function(a){},"do":function(){var a=this,b;switch(this.outclass){case "warning":b="ui-icon ui-icon-alert";
break;case "error":b="ui-icon ui-icon-circle-close";break;case "arrow":b="ui-icon ui-icon-arrowthick-1-e";break;default:b="ui-icon ui-icon-info"}for(var d=0;d<this.lines.length;d++)(function(d){a.markers[d]=$("<div><span class='"+b+"'></span></div>");if(a.content){var c=$("<div><span class='markerToolTip'></span></div>").append(a.content);a.markers[d].tooltip({track:!1,tooltipClass:"markerToolTip",items:a.markers[d].find("span"),content:c.prop("outerHTML")}).dblclick(function(){a.markers[d].tooltip({disabled:!0});
c.dialog({title:a.boxtitle,width:a.boxwidth,height:a.boxheight,close:function(b,c){a.markers[d].tooltip({disabled:!1})}})})}a.onclick&&a.markers[d].click(a.onclick);a.editor.setGutterMarker(a.lines[d].init.line,a.gutter,a.markers[d][0])})(d)},selectMarker:function(){for(var a=0;a<this.lines.length;a++)this.markers[a].addClass("highlightline")},unselectMarker:function(){for(var a=0;a<this.lines.length;a++)this.markers[a].removeClass("highlightline")},undo:function(){for(var a=0;a<this.lines.length;a++)this.editor.setGutterMarker(this.lines[a].init.line,
this.gutter,null)}};return c}();function jQuerySelectorEscape(c){return c.replace(/[ !"#$%&'()*+,.\/:;<=>?@\[\\\]^`{|}~]/g,"\\$&")}
function getLines(c){var a=[];c.find("> line").each(function(){var b={line:null,ch:null},d={line:null,ch:null},c=$(this).attr("from");if(!c)throw"getLines Error: the attribute 'from' is obligatory";var e=parseInt(c)-1;if(isNaN(e))throw"getLines Error: invalid value ("+c+") for the attribute 'from'";b.line=e;var c=$(this).attr("fromch"),e=$(this).attr("to"),g=$(this).attr("toch");if(c&&(b.ch=parseInt(c),isNaN(b.ch)))throw"getLines Error: invalid value ("+c+") for the attribute 'fromch'";if(e){if(d.line=
parseInt(e)-1,isNaN(d.line))throw"getLines Error: invalid value ("+e+") for the attribute 'to'";}else d.line=b.from;if(g&&(d.ch=parseInt(g),isNaN(d.ch)))throw"getLines Error: invalid value ("+g+") for the attribute 'toch'";a[a.length]={init:b,end:d}});return a}
window.OnClickAction=function(){function c(a){var b=this;this.codearea=a.codearea;this.lines=a.lines;this.dest=a.dest;this.outputmanager=a.outputmanager;this.autoclean=a.autoclean;this.commands=new Set;this.selectors=[];a.eicommands.each(function(){var d=$(this).attr(_ei.outlang.syntax.dest)||a.dest;$(this).attr(_ei.outlang.syntax.outclass);$(this).children().each(function(){a.outputmanager.parseCommand($(this),b.commands,{dest:d,outclass:a.outclass,outputmanager:a.outputmanager,filemanager:a.filemanager,
codearea:a.codearea,console:a.console,defaultConsoleId:a.defaultConsoleId})})});a.elements.find("> "+_ei.outlang.syntax.selector).each(function(){b.selectors[b.selectors.length]=$(this).attr(_ei.outlang.syntax.selectorvalue)})}c.parse=function(a,b){if(a[0].tagName!=_ei.outlang.syntax.onclick)return null;var d=a.attr(_ei.outlang.syntax.dest)||b.dest,f=a.attr(_ei.outlang.syntax.outclass)||b.outclass,e=a.attr(_ei.outlang.syntax.actionautoclean)||b.autoclean,g=a.find("> "+_ei.outlang.syntax.elements),
h=a.find("> "+_ei.outlang.syntax.eicommands);return new c({eicommands:h,elements:g,outputmanager:b.outputmanager,outclass:f,autoclean:e,dest:d})};c.prototype={constructor:c,activate:function(){for(var a=this,b=0;b<this.selectors.length;b++)$(this.selectors[b]).each(function(){$(this).on("click",function(){a.outputmanager.performAction(a)})})},deActivate:function(){for(var a=0;a<this.selectors.length;a++)$(this.selectors[a]).each(function(){$(this).off("click")})},doAction:function(){this.commands&&
this.commands.asyncIterate(function(a){a["do"]()})},undoAction:function(){this.commands&&this.commands.asyncIterate(function(a){a.undo()})}};return c}();
window.Outline=function(){function c(b){a++;this.cmdengine=this.filemanager=this.outlineHolder=null;this.treeId="OUTLINE-"+a;this.olObj=null;this.olId=10;this.nodes=null;this.initialize(b);this.initOutline()}var a=0;c.prototype={constructor:c,initialize:function(a){this.outlineHolder=$(a.holder);this.filemanager=a.filemanager;this.cmdengine=a.cmdengine},olId_to_olTag:function(a){return"olobj-"+a},olTag_to_olId:function(a){return a.substr(6,a.length-6)},initOutline:function(a){var d=this;this.outlineHolder.append("<div id='"+
this.treeId+"'></div>");this.jstree=this.outlineHolder.find("#"+this.treeId).jstree({json_data:{data:[]},themes:{theme:"classic"},types:{types:{SH:{start_drag:!1,delete_node:!1,remove:!1,icon:{image:"./ext/jstree/themes/classic/fileL.png"}},S:{start_drag:!1,delete_node:!1,remove:!1},H:{start_drag:!1,delete_node:!1,remove:!1,icon:{image:"./ext/jstree/themes/classic/folder.png"}},none:{start_drag:!1,delete_node:!1,remove:!1,icon:{image:"./ext/jstree/themes/classic/folderL.png"}},"#":{start_drag:!1,
delete_node:!1,remove:!1}}},plugins:"themes json_data ui crrm checkbox types".split(" ")}).bind("loaded.jstree",function(c,e){d.buildInitOutline();a&&a()}).bind("create_node.jstree",function(a,b){})},getSelected:function(){var a=this,d=[];this.jstree.jstree("get_checked",this.treeHolder,!0).each(function(){var c=$(this).attr("olId");switch(a.olObj[c].info.attr.rel){case "SH":case "S":d[d.length]=a.olObj[c].info.attr.name}});return d},buildInitOutline:function(){this.olId=1;this.olObj=[]},addNode:function(a){var d;
d="true"==a.selectable?"true"==a.hiericaly?"SH":"S":"true"==a.hiericaly?"H":"none";var c=0,e;a.parentId&&(c=a.parentId,e=this.olObj[c].node);a={data:a.name,attr:{id:this.olId_to_olTag(this.olId),olId:this.olId,rel:d,icon:a.icon,name:a.value}};e=this.jstree.jstree("create",e,"last",a,!1,!0);this.olObj[this.olId]={info:a,node:e};this.olId++;return this.olId-1},addChilds:function(a,d){var c=this;$(a).find(">category").each(function(){var a={name:$(this).attr("text"),selectable:$(this).attr("selectable"),
value:$(this).attr("value"),icon:$(this).attr("icon"),parentId:d},a=c.addNode(a);c.addChilds(this,a)})},resetLayout:function(a){a=$(a).find("ei_response");this.addChilds(a,null)},refresh:function(a){var d=this;a=d.filemanager.getEiFiles(a);var c=$("<div class='applyingToolDialog'>Refreshing Outline, please wait!<div class='applyingToolDialogProgBar' id='progressbar'</div></div>").dialog({modal:!0});c.find("#progressbar").progressbar({value:!1});this.cmdengine.exec({server:_ei.outline.server,appId:_ei.outline.app,
files:a,result:{media:"stdin"}},function(a){d.outlineHolder.empty();d.initOutline(function(){d.resetLayout(a)});c.dialog("close")},function(a){d.outlineHolder.empty();d.initOutline();c.dialog("close");console.log("ERROR",a)})}};return c}();
window.OutputManager=function(){function c(a){this.CommandsCollection=[PrintOnConsoleCommand,AddMarkerCommand,HighlightLinesCommand,SetCSSCommand,AddInLineMarkerCommand,DialogBoxCommand,WriteFileCommand];this.ActionsCollection=[CodeLineAction,OnClickAction];this.codearea=this.console=null;this.setOptions(a);this.commands=new Set;this.actions=new Set;this.lastAction=null;this.defaultConsoleId=this.console.createWin("default","Default Console");this.console.switchWin(this.defaultConsoleId);this.lastOutput=
null;this.version=0}c.prototype={constructor:c,setOptions:function(a){this.console=a.console;this.codearea=a.codearea;this.filemanager=a.filemanager},output:function(a){this.clearAllAnnotations();var b=$(a).find(_ei.outlang.syntax.eiout);0==b.size()&&(a=jQuery.parseXML("<"+_ei.outlang.syntax.eiout+" version='1'><"+_ei.outlang.syntax.eicommands+"><"+_ei.outlang.syntax.printonconsole+"><"+_ei.outlang.syntax.content+" format='text'>"+$(a).text()+"</"+_ei.outlang.syntax.content+"></"+_ei.outlang.syntax.printonconsole+
"></"+_ei.outlang.syntax.eicommands+"></"+_ei.outlang.syntax.eiout+">"),b=$(a).find(_ei.outlang.syntax.eiout));this.version=$(b).attr("version");this.lastOutput=b;try{this.executeEIOutput(b)}catch(d){console.log("Error occurred while processing the output:"),console.log(d),alert("Error occurred while processing the output, see the Javascript console")}},executeEIOutput:function(a){var b=this;this.commands=new Set;a.find("> "+_ei.outlang.syntax.eicommands).each(function(){var a=$(this).attr(_ei.outlang.syntax.dest)||
b.codearea.getCurrentTabId(),c=$(this).attr(_ei.outlang.syntax.outclass);$(this).children().each(function(){b.parseCommand($(this),b.commands,{outclass:c,dest:a})})});this.actions=new Set;a.find("> "+_ei.outlang.syntax.eiactions).each(function(){var a=$(this).attr(_ei.outlang.syntax.dest)||b.codearea.getCurrentTabId(),c=$(this).attr(_ei.outlang.syntax.outclass),e=$(this).attr(_ei.outlang.syntax.actionautoclean)||!0;$(this).children().each(function(){b.parseAction($(this),b.actions,{outclass:c,dest:a,
autoclean:e})})});this.commands.asyncIterate(function(a){a["do"]()});this.actions.asyncIterate(function(a){a.activate()})},parseCommand:function(a,b,d){for(var c=null,e=0;e<this.CommandsCollection.length;e++)if(c=this.CommandsCollection[e].parse(a,{dest:d.dest,outclass:d.outclass,outputmanager:this,filemanager:this.filemanager,codearea:this.codearea,console:this.console,defaultConsoleId:this.defaultConsoleId}),null!=c){b.add(c);return}console.log("Error while parsing the command:");console.log(a);
throw"Parsing a command has failed";},parseAction:function(a,b,d){for(var c=null,e=0;e<this.ActionsCollection.length;e++)if(c=this.ActionsCollection[e].parse(a,{dest:d.dest,outclass:d.outclass,outputmanager:this,filemanager:this.filemanager,codearea:this.codearea,console:this.console,autoclean:this.autoclean,defaultConsoleId:this.defaultConsoleId}),null!=c){b.add(c);return}throw"Unknow Action";},performAction:function(a){if(this.lastAction){var b;b=this.lastAction instanceof Array?this.lastAction:
[this.lastAction];for(var d=0;d<b.length;d++)b[d].undoAction()}this.lastAction==a?this.lastAction=null:(this.lastAction=a,this.lastAction.doAction())},performActions:function(a){if(this.lastAction){var b;b=this.lastAction instanceof Array?this.lastAction:[this.lastAction];for(var d=0;d<b.length;d++)b[d].undoAction()}if(this.lastAction==a)this.lastAction=null;else for(this.lastAction=a,d=0;d<a.length;d++)a[d].doAction()},clearAllAnnotations:function(){this.commands.asyncIterate(function(a){a.undo()});
this.actions.asyncIterate(function(a){a.deActivate()});this.lastAction=!1;this.console.initConsole();this.defaultConsoleId=this.console.createWin("default","Default Console");this.console.switchWin(this.defaultConsoleId)}};return c}();
window.Parameters=function(){function c(b,d){a++;this.paramsId="OPTS-"+a;this.paramsHolder=b;this.accord=null;this.sectionInfoById=[];this.secId=0;this.setOptions(d);this.initParameters()}var a=0;c.prototype={constructor:c,sectionId_to_sectionTag:function(a){return"section-"+a},setOptions:function(){},initParameters:function(){$(this.paramsHolder).append("<div><p>Below you find the parameters of the different section</p><div style='height: 200px;' id='"+this.paramsId+"'></div></div>");this.accord=
$(this.paramsHolder).find("#"+this.paramsId).accordion({collapsible:!0,heightStyle:"content",active:0,icons:{header:"ui-icon-circle-arrow-e",activeHeader:"ui-icon-circle-arrow-s"}})},addSection:function(a,d,c){var e=this,g=this.sectionId_to_sectionTag(d);this.accord.append("<h3 id='label-"+g+"'>"+a+"</h3><div id='"+g+"'></div>");this.accord.accordion("refresh");this.accord.find("#"+g).append("<button id='def-"+g+"'>b1</button><br/><br/>");$("#def-"+g).button({label:"Restore Default Values"});$("#def-"+
g).click(function(){e.restoreDefaultValues(d)});this.sectionInfoById[d]={id:d,tag:g,secId:this.secId,params:[]};this.secId++;c&&this.addParamsFromXML(d,c)},addParamsFromXML:function(a,d){var c=this;$(d).find("> ").each(function(){c.addParamFromXML(a,this)})},addParamFromXML:function(a,d){var c={selectone:"combo",flag:"checkbox",selectmany:"comboMultiple",textfield:"textfield"},e=d.tagName;d=$(d);var c=d.attr("widget")?d.attr("widget"):c[e],e=d.attr("name"),g={"short":d.find("> desc").find("short").text(),
"long":d.find("> desc").find("long").text()},h;h=d.find("> default").attr("value")?d.find("> default").attr("value"):d.find("> default").text();switch(c){case "checkbox":this.addCheckWidget(a,{id:e,desc:g,multiple:!1,default_value:h});break;case "checkboxMultiple":this.addCheckWidget(a,{id:e,desc:g,multiple:!0,default_value:h});break;case "combo":var k=[];d.find("option").each(function(a){var b=$(this).attr("value"),d=$(this).find("desc > short").text(),c=$(this).find("desc > long").text();d&&""!=
d||(d=b);c&&""!=c||(c=b);k[a]={value:b,desc:{"short":d,"long":c}}});this.addComboWidget(a,{id:e,desc:g,multiple:!1,options:k,default_value:h});break;case "comboMultiple":k=[];d.find("option").each(function(a){var b=$(this).attr("value"),d=$(this).find("desc > short").text(),c=$(this).find("desc > long").text();d&&""!=d||(d=b);c&&""!=c||(c=b);k[a]={value:b,desc:{"short":d,"long":c}}});this.addComboWidget(a,{id:e,desc:g,multiple:!0,options:k,default_value:h});break;case "radio":this.addRadioWidget(a,
{id:e,desc:g,default_value:h});break;case "textfield":this.addTextfieldWidget(a,{multiple:!1,id:e,desc:g,default_value:h});break;case "textarea":this.addTextfieldWidget(a,{multiple:!0,id:e,desc:g,default_value:h})}},addCheckWidget:function(a,d){var c=this.sectionInfoById[a],e=void 0;d.callback&&(e=function(a,b){d.callback({value:b?"yes":"no"})});e=new CheckBoxWidget({id:d.id,options:[{value:"yes",selected:"yes"==d.default_value,desc:d.desc,isBoolean:!0}],callback:e});this.accord.find("#"+c.tag).append(e.domRoot());
this.accord.accordion("refresh");this.sectionInfoById[a].params[d.id]=e},addComboWidget:function(a,d){var c=this.sectionInfoById[a],e=new ComboWidget({id:d.id,desc:d.desc,default_value:d.default_value,multiple:d.multiple,options:d.options,callback:d.callback});this.accord.find("#"+c.tag).append(e.domRoot());this.accord.accordion("refresh");this.sectionInfoById[a].params[d.id]=e},addTextfieldWidget:function(a,d){var c=this.sectionInfoById[a],e=new TextAreaWidget({id:d.id,desc:d.desc,multiple:d.multiple,
default_value:d.default_value});this.accord.find("#"+c.tag).append(e.domRoot());this.accord.accordion("refresh");this.sectionInfoById[a].params[d.id]=e},restoreDefaultValues:function(a,d){this.sectionId_to_sectionTag(a);if(0>a)for(var c in this.sectionInfoById)this.restoreDefaultValues(c);else for(c in this.sectionInfoById[a].params)this.sectionInfoById[a].params[c].restoreDefault()},setActiveParameSet:function(a){void 0!=a?this.accord.accordion({active:this.sectionInfoById[a].secId}):this.accord.accordion({active:!1});
this.accord.accordion("refresh")},getParams:function(a){var d=[];a=this.sectionInfoById[a].params;for(var c in a)d[c]=a[c].getValue();return d}};return c}();
window.PrintOnConsoleCommand=function(){function c(a){this.console=a.console;this.consoleId=a.consoleId;this.consoleTitle=a.consoleTitle;this.format=a.format;this.content=(new DocContent({content:a.content,outclass:a.outclass})).getDOM();this.added=!1}c.parse=function(a,b){if(a[0].tagName!=_ei.outlang.syntax.printonconsole)return null;var d=a.attr(_ei.outlang.syntax.outclass)||b.outclass,f=a.attr(_ei.outlang.syntax.consoletitle),e=a.attr(_ei.outlang.syntax.consoleid)||b.defaultConsoleId,g=a.find("> "+
_ei.outlang.syntax.content);return new c({console:b.console,consoleId:e,consoleTitle:f,content:g,outclass:d})};c.prototype={constructor:c,"do":function(){this.added||(this.console.existWin(this.consoleId)||this.console.createWin(this.consoleId,this.consoleTitle),this.console.addContentToWin(this.consoleId,this.content),this.added=!0)},undo:function(){}};return c}();
window.Set=function(){function c(){this.value=[]}c.prototype={constructor:c,add:function(a){this.value[this.value.length]=a},union:function(a){for(var b=0;b<a.value.length;b++)this.value[this.value.length]=a.value[b]},get:function(){return this.value},size:function(){return this.value.length},iterate:function(a){for(var b=0;b<this.value.length;b++)a(this.value[b])},asyncIterate:function(a,b){this.asyncIterate_aux(a,0,b)},asyncIterate_aux:function(a,b,d){var c=this;setTimeout(function(){b<c.value.length?
(a(c.value[b]),c.asyncIterate_aux(a,b+1,d)):d&&d()},0)}};return c}();
window.SetCSSCommand=function(){function c(a){var b=this;this.selectors=[];this.cssproperties=[];a.elements.find("> "+_ei.outlang.syntax.selector).each(function(){b.selectors[b.selectors.length]=$(this).attr(_ei.outlang.syntax.selectorvalue)});a.cssproperties.find("> "+_ei.outlang.syntax.cssproperty).each(function(){b.cssproperties[b.cssproperties.length]={name:$(this).attr(_ei.outlang.syntax.csspropertyname),value:$(this).attr(_ei.outlang.syntax.csspropertyvalue),oldvalue:null}})}c.parse=function(a,
b){if(a[0].tagName!=_ei.outlang.syntax.setcss)return null;var d=a.find("> "+_ei.outlang.syntax.elements),f=a.find("> "+_ei.outlang.syntax.cssproperties);return new c({elements:d,cssproperties:f})};c.prototype={constructor:c,"do":function(){for(var a=this,b=0;b<this.selectors.length;b++)$(this.selectors[b]).each(function(){for(var b=$(this),c=0;c<a.cssproperties.length;c++)a.cssproperties[c].oldvalue=b.attr(a.cssproperties[c].name),b.css(a.cssproperties[c].name,a.cssproperties[c].value)})},undo:function(){for(var a=
this,b=0;b<this.selectors.length;b++)$(this.selectors[b]).each(function(){for(var b=$(this),c=0;c<a.properties.length;c++)b.css(a.properties[c].name,a.properties[c].oldvalue)})}};return c}();
window.SVGContent=function(){function c(a){this.content=$("<div></div>");a=$(a.content).find("> svg");if(1!=a.length)throw"an svg conetnt environment must include exactly one svg environemt inside";a=a.prop("outerHTML");a=$(a);a.css("overflow","auto");this.content.append(a);a.svg()}c.parse=function(a,b){var d=a[0].tagName,f=a.attr("format");if(d!=_ei.outlang.syntax.content||f!=_ei.outlang.syntax.svgcontent)return null;d=a.attr(_ei.outlang.syntax.outclass)||b.outclass;return new c({content:a,outclass:d})};
c.prototype={constructor:c,getDOM:function(){return this.content}};return c}();
window.TextAreaWidget=function(){function c(a){this.widgetInfo=a;this.id=a.id;this.env=$("<div class='ei-paramwidget-combo'></div>");this.env.append("<div class='params-left-col'></div><div class='params-mid-col'><div class='desc'>"+a.desc["short"]+"</div><div class='selector'></div></div>");a.multiple?(this.env.find("div.selector").append("<textarea rows='5' name='textfield'>"+a.default_value+"</textarea>"),this.textfield=this.env.find("textarea")):(this.env.find("div.selector").append("<input type='text' name='textfield' value='"+
a.default_value+"'/>"),this.textfield=this.env.find("input"));if(a.desc["long"]){var b=$("<div class='params-right-col'><span class='ui-icon ui-icon-info'></span></div>");this.env.append(b);b.tooltip({items:b.find("span"),content:a.desc["long"]})}}c.prototype={constructor:c,domRoot:function(){return this.env},getId:function(){return id},getValue:function(){var a=[];a[0]=""+this.textfield.val()+"";return a},restoreDefault:function(){this.env.find("input").val(this.widgetInfo.default_value)}};return c}();
window.TextContent=function(){function c(a){this.content=$("<div></div>");this.content.append("<div class='preformatted'>"+$(a.content).text()+"</div>")}c.parse=function(a,b){var d=a[0].tagName,f=a.attr(_ei.outlang.syntax.format)||_ei.outlang.syntax.textcontent;if(d!=_ei.outlang.syntax.content||f!=_ei.outlang.syntax.textcontent)return null;d=a.attr(_ei.outlang.syntax.outclass)||b.outclass;return new c({content:a,outclass:d})};c.prototype={constructor:c,getDOM:function(){return this.content}};return c}();
window.Tools=function(){function c(a){this.toolId=1;this.currToolId=null;this.tools=[];this.console=this.cmdengine=this.outline=this.filemanager=this.helps=this.parameters=null;this.setOptions(a)}c.prototype={constructor:c,getNumTools:function(){return this.toolId-1},setOptions:function(a){this.parameters=a.parameters;this.selector=a.selector;this.filemanager=a.filemanager;this.outline=a.outline;this.cmdengine=a.cmdengine;this.outputmanager=a.outputmanager;this.helps=a.helps;this.selector.setToolsObj(this)},
addTool:function(a,b){var c=a.find("appinfo").find("acronym").text(),f=a.find("appinfo").find("title").text(),e=a.attr("id")?a.attr("id"):this.toolId;this.tools[e]={acronym:c,title:f,server:b};this.parameters.addSection(c,e,a.find("parameters"));this.helps.addSection(c,e,a.find("apphelp"));this.selector.addTool(e,c);null==this.currToolId&&(this.currToolId=e,this.parameters.setActiveParameSet(e));this.toolId++},setActiveTool:function(a){this.currToolId=a;this.parameters.setActiveParameSet(a)},apply:function(a,
b){var c=this;b||(b=this.currToolId);var f=this.tools[b],e=c.filemanager.getEiFiles(a),g=c.outline.getSelected(),h=this.parameters.getParams(b),k=$("<div class='applyingToolDialog'>Applying "+f.acronym+", please wait!<div class='applyingToolDialogProgBar' id='progressbar'</div></div>").dialog({modal:!0});k.find("#progressbar").progressbar({value:!1});this.cmdengine.exec({server:f.server,cmd:f.cmd,appId:b,params:h,files:e,entries:g,pprefix:f.pprefix,result:f.result},function(a){k.dialog("close");c.outputmanager.output(a)},
function(a){k.dialog("close");var b=$.parseXML("<ei_response><eiout version='-1'><eicommands><printconsole consoleid='ERROR' consolename='ERROR'><content>ERROR</content></printconsole></eicommands></eiout></ei_response>");c.outputmanager.output(b);console.log("ERROR",a)})}};return c}();
window.ToolSelector=function(){function c(a){this.tools=this.selector=this.selectorHolder=null;this.setOptions(a);this.initSelector()}c.prototype={constructor:c,setOptions:function(a){this.selectorHolder=$(a.holder)},initSelector:function(){var a=this;this.selector=$("<select class='custom-combobox custom-combobox-input ui-widget ui-widget-content ui-state-default ui-corner-all' id='combobox' ></select>");this.selector.change(function(){a.tools.setActiveTool($(this).val())});this.selectorHolder.append(this.selector)},
setToolsObj:function(a){this.tools=a},addTool:function(a,b){this.selector.append("<option value='"+a+"'>"+b+"</option>")}};return c}();
window.WriteFileCommand=function(){function c(a){this.filename=a.filename;this.content=a.content;this.overwrite=a.overwrite;this.filemanager=a.filemanager}c.parse=function(a,b){if(a[0].tagName!=_ei.outlang.syntax.writefile)return null;var d=a.attr(_ei.outlang.syntax.filename);if(!d)throw"The 'filename' is missing in the "+_ei.outlang.syntax.writefile+" command";var f=a.attr(_ei.outlang.syntax.overwrite),f="true"==f?!0:!1,e=$(a).text();return new c({filename:d,content:e,overwrite:f,filemanager:b.filemanager})};
c.prototype={constructor:c,"do":function(){this.filemanager.createFile(this.filename,this.content,this.overwrite)},undo:function(){}};return c}();
